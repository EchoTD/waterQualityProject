<!-- frontend/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard – Water Quality App</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    .logout-btn {
      float: right;
      background: #cc0033;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.6em 1.2em;
      font-size: 1em;
      cursor: pointer;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ddd; padding: 0.5em; text-align: left; }
  </style>
</head>
<body>
  <button class="logout-btn" id="logout">Logout</button>
  <h1>Dashboard</h1>
  <p>Sensor data will appear below:</p>
  <table id="data-table">
    <thead><tr><th>ID</th><th>Type</th><th>Value</th><th>Timestamp</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    // redirect to login if no token
    const token = localStorage.getItem('token');
    if (!token) location.href = '/login.html';

    document.getElementById('logout').addEventListener('click', () => {
      localStorage.removeItem('token');
      location.href = '/login.html';
    });

    // fetch and render sensor data
    (async function(){
      try {
        const res = await fetch('/api/sensor-data', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!res.ok) throw new Error('Unauthorized');
        const data = await res.json();
        const tbody = document.querySelector('#data-table tbody');
        data.forEach(d => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${d.id}</td>
            <td>${d.type}</td>
            <td>${d.temperature}</td>
            <td>${new Date(d.timestamp).toLocaleString()}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        alert('Failed to load data: ' + err.message);
        if (err.message === 'Unauthorized') {
          localStorage.removeItem('token');
          location.href = '/login.html';
        }
      }
    })();
  </script>
</body>
</html>

